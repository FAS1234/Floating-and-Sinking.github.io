<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¬å‘Šåˆ—è¡¨ - Floating and Sinking æµ®å¤œæ²‰æœˆ</title>
    <script src="auth_manager.js"></script>
    <style>
        /* åŸºç¡€æ ·å¼é‡ç½® */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #ffffff;
            overflow-x: hidden;
        }

        /* æ¢µé«˜é£æ ¼åŠ¨æ€èƒŒæ™¯ */
        body {
            background-color: #000;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(255, 215, 0, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(0, 0, 139, 0.4) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(148, 0, 211, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 60% 60%, rgba(255, 140, 0, 0.3) 0%, transparent 50%),
                linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            background-size: 300% 300%;
            animation: vanGoghShift 20s ease infinite;
            z-index: -1;
            opacity: 0.8;
            will-change: background-position;
        }

        @keyframes vanGoghShift {
            0% { background-position: 0% 50%; }
            25% { background-position: 100% 50%; }
            50% { background-position: 100% 100%; }
            75% { background-position: 0% 100%; }
            100% { background-position: 0% 50%; }
        }
        
        /* æ·»åŠ æ¢µé«˜é£æ ¼çš„çº¹ç†æ•ˆæœ */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(255, 215, 0, 0.05) 10px, rgba(255, 215, 0, 0.05) 20px),
                repeating-linear-gradient(-45deg, transparent, transparent 10px, rgba(0, 0, 139, 0.05) 10px, rgba(0, 0, 139, 0.05) 20px);
            background-size: 200px 200px;
            animation: textureMove 30s linear infinite;
            z-index: -1;
            opacity: 0.6;
            will-change: transform;
        }
        
        @keyframes textureMove {
            0% { transform: translate(0, 0); }
            100% { transform: translate(200px, 200px); }
        }

        /* å°Šé‡ç”¨æˆ·åŠ¨ç”»åå¥½è®¾ç½® */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                scroll-behavior: auto !important;
            }
        }

        /* å¤´éƒ¨æ ·å¼ */
        header {
            background-color: rgba(26, 26, 46, 0.9);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #667eea;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .fas-logo {
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: 0.5px;
        }

        /* å¯¼èˆªæ æ ·å¼ */
        nav ul {
            display: flex;
            list-style: none;
            gap: 2rem;
        }

        nav ul li a {
            color: #ffffff;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s ease;
            position: relative;
        }

        nav ul li a:hover {
            color: #667eea;
        }

        nav ul li a::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: -5px;
            left: 0;
            background-color: #667eea;
            transition: width 0.3s ease;
        }

        nav ul li a:hover::after {
            width: 100%;
        }

        /* ç®¡ç†å‘˜æ“ä½œæŒ‰é’®ç»„ */
        .admin-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        /* é€šç”¨æŒ‰é’®æ ·å¼ */
        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: #ffffff;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 5px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin-right: 10px;
        }

        .btn.cancel {
            background: linear-gradient(45deg, #6c757d, #495057);
        }
        
        .btn.delete {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        /* æŒ‰é’®ä¼ªå…ƒç´  */
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        /* ç®¡ç†å‘˜ç™»å½•æŒ‰é’® */
        .admin-login-btn {
            padding: 0.5rem 1rem;
            background-color: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(102, 126, 234, 0.3);
        }

        .admin-login-btn:hover {
            background-color: #5a67d8;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.5);
        }

        /* è¿”å›é¦–é¡µæŒ‰é’® */
        .back-home-btn {
            background: rgba(59, 130, 246, 0.1);
            color: #3b82f6;
            border: 1px solid rgba(59, 130, 246, 0.3);
            margin-bottom: 2rem;
        }

        .back-home-btn:hover {
            background: rgba(59, 130, 246, 0.2);
            transform: translateX(-3px);
        }

        /* å‘å¸ƒå…¬å‘ŠæŒ‰é’® */
        .publish-btn {
            background: linear-gradient(45deg, #10b981, #059669);
            color: white;
            margin-bottom: 2rem;
            margin-right: 10px;
        }

        .publish-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.4);
        }

        /* å®¹å™¨æ ·å¼ */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 3rem 2rem;
        }

        /* å…¬å‘ŠåŒºåŸŸæ ·å¼ */
        .announcements {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 2.5rem;
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .announcements h2 {
            font-size: 2.2rem;
            font-weight: 700;
            background: linear-gradient(135deg, #f97316, #f59e0b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1rem;
        }

        .announcements-subtitle {
            color: #94a3b8;
            font-size: 1rem;
            margin-bottom: 2.5rem;
        }

        /* å…¬å‘Šåˆ—è¡¨æ ·å¼ */
        .announcements-list {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        /* å•ä¸ªå…¬å‘Šæ ·å¼ */
        .announcement-item {
            padding: 1rem;
            border-bottom: 1px solid rgba(102, 126, 234, 0.2);
            margin-bottom: 1rem;
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 5px;
            transition: all 0.3s ease;
        }

        .announcement-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .announcement-item:hover {
            background-color: rgba(0, 0, 0, 0.3);
            box-shadow: 0 2px 10px rgba(102, 126, 234, 0.2);
        }

        /* å…¬å‘Šæ“ä½œæŒ‰é’®æ ·å¼ */
        .announcement-actions {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 1rem;
        }

        .announcement-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .announcement-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #f8fafc;
            margin-bottom: 0.5rem;
            line-height: 1.4;
            flex: 1;
        }

        .announcement-date {
            font-size: 0.85rem;
            color: #64748b;
            font-weight: 500;
            background: rgba(255, 255, 255, 0.05);
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            white-space: nowrap;
        }

        .announcement-content {
            color: #cbd5e1;
            line-height: 1.8;
            margin-bottom: 1.5rem;
            font-size: 1rem;
            word-wrap: break-word;
        }

        /* å…¬å‘Šæ“ä½œæŒ‰é’® */
        .announcement-actions {
            display: flex;
            gap: 0.75rem;
            justify-content: flex-end;
            margin-top: 1rem;
        }

        .btn.announcement-btn {
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
        }

        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 5rem 2rem;
            color: #64748b;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .empty-state-text {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
        }

        .empty-state-subtext {
            font-size: 0.95rem;
            opacity: 0.8;
        }

        /* æ¨¡æ€æ¡†æ ·å¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(8px);
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: rgba(15, 23, 42, 0.95);
            margin: 4% auto;
            padding: 0;
            border-radius: 16px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            animation: modalSlideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-header {
            padding: 1.5rem 2rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            color: #f8fafc;
            font-size: 1.5rem;
            font-weight: 600;
        }

        .close {
            color: #94a3b8;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .close:hover,
        .close:focus {
            color: #f8fafc;
            background: rgba(255, 255, 255, 0.05);
        }

        .modal-body {
            padding: 2rem;
        }

        .modal-footer {
            padding: 1.5rem 2rem;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }

        /* è¡¨å•æ ·å¼ */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #f8fafc;
            font-weight: 500;
            font-size: 0.95rem;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 0.9rem 1rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            color: #f8fafc;
            font-size: 1rem;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #a855f7;
            box-shadow: 0 0 0 3px rgba(168, 85, 247, 0.1);
            background: rgba(255, 255, 255, 0.08);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 150px;
            line-height: 1.6;
        }

        /* æŒ‰é’®æ ·å¼ */
        .btn.cancel {
            background: rgba(148, 163, 184, 0.1);
            color: #94a3b8;
            border: 1px solid rgba(148, 163, 184, 0.3);
        }

        .btn.cancel:hover {
            background: rgba(148, 163, 184, 0.2);
        }

        .btn.primary {
            background: linear-gradient(135deg, #a855f7, #9333ea);
            color: white;
        }

        .btn.primary:hover {
            background: linear-gradient(135deg, #9333ea, #7e22ce);
        }

        .btn.danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }

        .btn.danger:hover {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            header {
                flex-direction: column;
                gap: 1.5rem;
                padding: 1rem;
            }

            nav ul {
                gap: 1.5rem;
            }

            .container {
                padding: 2rem 1rem;
            }

            .announcements {
                padding: 1.5rem;
            }

            .announcements h2 {
                font-size: 1.8rem;
            }

            .announcement-item {
                padding: 1.5rem;
            }

            .announcement-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .announcement-actions {
                flex-direction: column;
            }

            .modal-content {
                width: 95%;
                margin: 10% auto;
            }

            .modal-header,
            .modal-body,
            .modal-footer {
                padding: 1.25rem;
            }
        }

        @media (max-width: 480px) {
            .fas-logo {
                font-size: 1.5rem;
            }

            nav ul {
                gap: 1rem;
                font-size: 0.9rem;
            }

            .announcements {
                padding: 1rem;
            }

            .announcement-item {
                padding: 1rem;
            }

            .announcement-title {
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>
    <!-- å¤´éƒ¨ -->
    <header>
        <div class="fas-logo">Floating and Sinking</div>
        <div style="display: flex; align-items: center; gap: 2rem;">
            <nav>
                <ul>
                    <li><a href="index.html">é¦–é¡µ</a></li>
                    <li><a href="#announcements">å…¬å‘Š</a></li>
                    <li><a href="#members">æˆå‘˜</a></li>
                    <li><a href="#about">å…³äº</a></li>
                </ul>
            </nav>
            <div class="admin-actions">
                <button id="adminManageBtn" class="admin-login-btn" style="display: none;">è´¦å·ç®¡ç†</button>
                <button id="adminLoginBtn" class="admin-login-btn">ç®¡ç†å‘˜ç™»å½•</button>
            </div>
        </div>
    </header>

    <!-- ä¸»è¦å†…å®¹ -->
    <main class="container">
        <!-- è¿”å›é¦–é¡µæŒ‰é’® -->
        <a href="index.html" class="btn back-home-btn">
            â† è¿”å›é¦–é¡µ
        </a>

        <!-- å…¬å‘ŠåŒºåŸŸ -->
        <section class="announcements" id="announcements">
            <h2>å…¬ä¼šå…¬å‘Šåˆ—è¡¨</h2>
            <p class="announcements-subtitle">æŸ¥çœ‹å…¬ä¼šçš„æœ€æ–°åŠ¨æ€å’Œé‡è¦é€šçŸ¥</p>
            
            <!-- å‘å¸ƒå…¬å‘ŠæŒ‰é’®ï¼ˆç®¡ç†å‘˜å¯è§ï¼‰ -->
            <button id="publishAnnouncementBtn" class="btn publish-btn admin-only" style="display: none;">
                + å‘å¸ƒæ–°å…¬å‘Š
            </button>
            
            <!-- å…¬å‘Šåˆ—è¡¨ -->
            <div class="announcements-list" id="announcementsList"></div>
        </section>
    </main>

    <!-- å…¬å‘Šç¼–è¾‘æ¨¡æ€æ¡† -->
    <div id="announcementModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="announcementModalTitle">å‘å¸ƒå…¬å‘Š</h2>
                <span class="close" id="closeAnnouncementModal">&times;</span>
            </div>
            <div class="modal-body">
                <form id="announcementForm">
                    <div class="form-group">
                        <label for="announcementTitle">æ ‡é¢˜</label>
                        <input type="text" id="announcementTitle" name="announcementTitle" required>
                    </div>
                    <div class="form-group">
                        <label for="announcementContent">å†…å®¹</label>
                        <textarea id="announcementContent" name="announcementContent" rows="6" required></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn cancel" onclick="closeAnnouncementModalFunc()">å–æ¶ˆ</button>
                <button type="submit" class="btn primary" form="announcementForm">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <!-- ç®¡ç†å‘˜ç™»å½•æ¨¡æ€æ¡† -->
    <div id="adminLoginModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ç®¡ç†å‘˜ç™»å½•</h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <form id="adminLoginForm">
                    <div class="form-group">
                        <label for="username">è´¦å·</label>
                        <input type="text" id="username" name="username" required>
                    </div>
                    <div class="form-group">
                        <label for="password">å¯†ç </label>
                        <div style="position: relative;">
                            <input type="password" id="password" name="password" required>
                            <button type="button" id="togglePassword" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; color: #64748b; font-size: 18px;">
                                ğŸ‘ï¸
                            </button>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="submit" class="btn primary" form="adminLoginForm">ç™»å½•</button>
            </div>
        </div>
    </div>

    <!-- ç™»å½•æ¶ˆæ¯æ¨¡æ€æ¡† -->
    <div id="loginMessageModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="loginMessageTitle">ç™»å½•æ¶ˆæ¯</h2>
                <span class="close" id="closeLoginMessageModal">&times;</span>
            </div>
            <div class="modal-body">
                <div id="loginMessage"></div>
            </div>
            <div class="modal-footer">
                <button id="closeLoginMessageBtn" class="btn primary">ç¡®å®š</button>
            </div>
        </div>
    </div>

    <!-- ç¡®è®¤å¯¹è¯æ¡†æ¨¡æ€æ¡† -->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="confirmTitle">ç¡®è®¤æ“ä½œ</h2>
                <span class="close">&times;</span>
            </div>
            <div class="modal-body">
                <p id="confirmMessage"></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn cancel" id="confirmCancelBtn">å–æ¶ˆ</button>
                <button type="button" class="btn danger" id="confirmDeleteBtn">ç¡®å®šåˆ é™¤</button>
            </div>
        </div>
    </div>

    <!-- åˆ é™¤æˆåŠŸæç¤ºæ¨¡æ€æ¡† -->
    <div id="successModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>æ“ä½œæˆåŠŸ</h2>
                <span class="close" id="closeSuccessModal">&times;</span>
            </div>
            <div class="modal-body">
                <p id="successMessage"></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn primary" id="successOkBtn">ç¡®å®š</button>
            </div>
        </div>
    </div>

    <script>
        // å…¬å‘Šæ•°æ®
        let announcements = [];
        
        // å½“å‰ç¼–è¾‘çš„å…¬å‘Šç´¢å¼•
        let currentEditIndex = -1;
        let currentDeleteIndex = -1;
        
        // ç®¡ç†å‘˜ç™»å½•çŠ¶æ€
        let currentAdminUser = null;
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // åŠ è½½å…¬å‘Šæ•°æ®
            loadAnnouncementsFromStorage();
            renderAnnouncements();
            
            // åˆå§‹åŒ–ç®¡ç†å‘˜è´¦å·
            initAdminAccounts();
            
            // æ£€æŸ¥å¹¶æ¢å¤ç™»å½•çŠ¶æ€
            checkLoginStatus();
            
            // ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
            bindEventListeners();
        });
        
        // ç»‘å®šæ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨
        function bindEventListeners() {
            // ç®¡ç†å‘˜ç™»å½•/é€€å‡ºæŒ‰é’®
            const loginBtn = document.getElementById('adminLoginBtn');
            loginBtn.addEventListener('click', function() {
                if (AuthManager.isLoggedIn) {
                    handleAdminLogout();
                } else {
                    openAdminLoginModal();
                }
            });
            
            // è´¦å·ç®¡ç†æŒ‰é’®
            const manageBtn = document.getElementById('adminManageBtn');
            manageBtn.addEventListener('click', function() {
                if (AuthManager.isLoggedIn) {
                    window.location.href = 'admin_management.html';
                }
            });
            
            // å‘å¸ƒå…¬å‘ŠæŒ‰é’®
            const publishBtn = document.getElementById('publishAnnouncementBtn');
            publishBtn.addEventListener('click', function() {
                openAnnouncementModal();
            });
            
            // ç®¡ç†å‘˜ç™»å½•è¡¨å•
            const loginForm = document.getElementById('adminLoginForm');
            loginForm.addEventListener('submit', handleAdminLogin);
            
            // å…¬å‘Šè¡¨å•
            const announcementForm = document.getElementById('announcementForm');
            announcementForm.addEventListener('submit', saveAnnouncement);
            
            // æ¨¡æ€æ¡†å…³é—­æŒ‰é’®
            document.getElementById('closeAnnouncementModal').addEventListener('click', closeAnnouncementModalFunc);
            document.getElementById('closeLoginMessageModal').addEventListener('click', closeLoginMessageModal);
            document.getElementById('closeSuccessModal').addEventListener('click', () => closeModal('successModal'));
            
            // ç¡®è®¤å¯¹è¯æ¡†æŒ‰é’®
            document.getElementById('confirmCancelBtn').addEventListener('click', () => closeModal('confirmModal'));
            document.getElementById('confirmDeleteBtn').addEventListener('click', deleteAnnouncement);
            
            // æˆåŠŸæç¤ºæ¡†æŒ‰é’®
            document.getElementById('successOkBtn').addEventListener('click', () => closeModal('successModal'));
            
            // ç™»å½•æ¶ˆæ¯æ¨¡æ€æ¡†æŒ‰é’®
            document.getElementById('closeLoginMessageBtn').addEventListener('click', closeLoginMessageModal);
            
            // å¯†ç æ˜¾ç¤º/éšè—
            const togglePasswordBtn = document.getElementById('togglePassword');
            if (togglePasswordBtn) {
                togglePasswordBtn.addEventListener('click', function() {
                    const passwordInput = document.getElementById('password');
                    const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
                    passwordInput.setAttribute('type', type);
                    this.textContent = type === 'password' ? 'ğŸ‘ï¸' : 'ğŸ™ˆ';
                });
            }
            
            // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
            window.addEventListener('click', function(event) {
                const modals = ['announcementModal', 'adminLoginModal', 'loginMessageModal', 'confirmModal', 'successModal'];
                modals.forEach(modalId => {
                    const modal = document.getElementById(modalId);
                    if (event.target === modal) {
                        closeModal(modalId);
                    }
                });
            });
            
            // ç›‘å¬localStorageå˜åŒ–ï¼Œå®ç°è·¨é¡µé¢ç™»å½•çŠ¶æ€åŒæ­¥
            window.addEventListener('storage', function(event) {
                if (event.key === 'adminToken' || event.key === 'currentAdminUser') {
                    checkLoginStatus();
                }
            });
        }
        
        // ä»æœ¬åœ°å­˜å‚¨åŠ è½½å…¬å‘Šæ•°æ®
        function loadAnnouncementsFromStorage() {
            try {
                const savedAnnouncements = localStorage.getItem('fasClubAnnouncements');
                if (savedAnnouncements) {
                    announcements = JSON.parse(savedAnnouncements);
                    
                    // éªŒè¯æ•°æ®æ ¼å¼
                    if (!Array.isArray(announcements)) {
                        throw new Error('å…¬å‘Šæ•°æ®æ ¼å¼é”™è¯¯');
                    }
                    
                    // ç¡®ä¿æ‰€æœ‰å…¬å‘Šéƒ½æœ‰å¿…è¦çš„å­—æ®µ
                    announcements = announcements.map(announcement => {
                        // ç¡®ä¿å…¬å‘Šæœ‰ID
                        if (!announcement.id) {
                            announcement.id = generateUniqueId();
                        }
                        
                        // ç¡®ä¿å…¬å‘Šæœ‰æ—¥æœŸ
                        if (!announcement.date) {
                            announcement.date = getCurrentDate();
                        }
                        
                        return announcement;
                    });
                    
                    // ä¿å­˜ä¿®å¤åçš„æ•°æ®
                    localStorage.setItem('fasClubAnnouncements', JSON.stringify(announcements));
                } else {
                    // ä½¿ç”¨é»˜è®¤å…¬å‘Šæ•°æ®
                    announcements = [
                        {
                            id: 1,
                            title: 'å…¬ä¼šæ‹›æ–°',
                            content: 'æˆ‘ä»¬æ­£åœ¨å¯»æ‰¾çƒ­çˆ±Minecraft PVPçš„ç©å®¶åŠ å…¥æˆ‘ä»¬çš„å›¢é˜Ÿï¼æ— è®ºä½ æ˜¯æ–°æ‰‹è¿˜æ˜¯è€æ‰‹ï¼Œåªè¦ä½ æœ‰çƒ­æƒ…å’Œæ¯…åŠ›ï¼Œéƒ½æ¬¢è¿åŠ å…¥æˆ‘ä»¬ï¼',
                            date: '2023-06-15'
                        },
                        {
                            id: 2,
                            title: 'PVPæ¯”èµ›é€šçŸ¥',
                            content: 'æœ¬å‘¨å…­å°†ä¸¾è¡Œå…¬ä¼šå†…éƒ¨PVPæ¯”èµ›ï¼Œå¥–å“ä¸°åšï¼Œæ¬¢è¿å¤§å®¶ç§¯æå‚ä¸ï¼',
                            date: '2023-06-10'
                        },
                        {
                            id: 3,
                            title: 'æœåŠ¡å™¨æ›´æ–°',
                            content: 'æœåŠ¡å™¨å·²æ›´æ–°è‡³æœ€æ–°ç‰ˆæœ¬ï¼Œæ–°å¢äº†ä¸€äº›PVPç›¸å…³çš„æ’ä»¶å’Œåœ°å›¾ï¼Œæ¬¢è¿å¤§å®¶ä½“éªŒï¼',
                            date: '2023-06-05'
                        }
                    ];
                    localStorage.setItem('fasClubAnnouncements', JSON.stringify(announcements));
                }
            } catch (error) {
                console.error('åŠ è½½å…¬å‘Šæ•°æ®å¤±è´¥:', error);
                // ä½¿ç”¨é»˜è®¤æ•°æ®
                announcements = [];
            }
        }
        
        // ä¿å­˜å…¬å‘Šæ•°æ®åˆ°æœ¬åœ°å­˜å‚¨
        function saveAnnouncementsToStorage() {
            try {
                localStorage.setItem('fasClubAnnouncements', JSON.stringify(announcements));
                return true;
            } catch (error) {
                console.error('ä¿å­˜å…¬å‘Šæ•°æ®å¤±è´¥:', error);
                return false;
            }
        }
        
        // æ¸²æŸ“å…¬å‘Šåˆ—è¡¨
        function renderAnnouncements() {
            const announcementsList = document.getElementById('announcementsList');
            announcementsList.innerHTML = '';
            
            // å¦‚æœæ²¡æœ‰å…¬å‘Š
            if (announcements.length === 0) {
                announcementsList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“¢</div>
                        <div class="empty-state-text">æš‚æ— å…¬å‘Š</div>
                        <div class="empty-state-subtext">
                            ${AuthManager.isLoggedIn ? 'ç‚¹å‡»ä¸Šæ–¹"å‘å¸ƒæ–°å…¬å‘Š"æŒ‰é’®åˆ›å»ºç¬¬ä¸€æ¡å…¬å‘Š' : 'æ•¬è¯·æœŸå¾…å…¬ä¼šçš„æœ€æ–°åŠ¨æ€'}
                        </div>
                    </div>
                `;
                return;
            }
            
            // æŒ‰æ—¥æœŸé™åºæ’åºå…¬å‘Šï¼ˆæœ€æ–°çš„åœ¨å‰é¢ï¼‰
            const sortedAnnouncements = [...announcements].sort((a, b) => {
                return new Date(b.date) - new Date(a.date);
            });
            
            // æ¸²æŸ“æ¯ä¸ªå…¬å‘Š
            sortedAnnouncements.forEach(announcement => {
                const announcementItem = document.createElement('div');
                announcementItem.className = 'announcement-item';
                
                // æ‰¾åˆ°å…¬å‘Šåœ¨åŸå§‹æ•°ç»„ä¸­çš„ç´¢å¼•
                const originalIndex = announcements.findIndex(a => a.id === announcement.id);
                
                announcementItem.innerHTML = `
                    <div class="announcement-header">
                        <div>
                            <div class="announcement-title">${announcement.title}</div>
                            <div class="announcement-date">${formatDate(announcement.date)}</div>
                        </div>
                    </div>
                    <div class="announcement-content">${announcement.content}</div>
                    ${AuthManager.isLoggedIn ? `
                        <div class="announcement-actions">
                            <button class="btn" onclick="editAnnouncement(${originalIndex})">ç¼–è¾‘å…¬å‘Š</button>
                            <button class="btn delete" onclick="confirmDeleteAnnouncement(${originalIndex})">åˆ é™¤å…¬å‘Š</button>
                        </div>
                    ` : ''}
                `;
                
                announcementsList.appendChild(announcementItem);
            });
        }
        
        // æ‰“å¼€å…¬å‘Šç¼–è¾‘æ¨¡æ€æ¡†
        function openAnnouncementModal() {
            currentEditIndex = -1;
            document.getElementById('announcementModalTitle').textContent = 'å‘å¸ƒå…¬å‘Š';
            document.getElementById('announcementForm').reset();
            document.getElementById('announcementModal').style.display = 'block';
            document.getElementById('announcementTitle').focus();
        }
        
        // ç¼–è¾‘å…¬å‘Š
        function editAnnouncement(index) {
            currentEditIndex = index;
            const announcement = announcements[index];
            
            document.getElementById('announcementModalTitle').textContent = 'ç¼–è¾‘å…¬å‘Š';
            document.getElementById('announcementTitle').value = announcement.title;
            document.getElementById('announcementContent').value = announcement.content;
            document.getElementById('announcementModal').style.display = 'block';
            document.getElementById('announcementTitle').focus();
        }
        
        // å…³é—­å…¬å‘Šç¼–è¾‘æ¨¡æ€æ¡†
        function closeAnnouncementModalFunc() {
            document.getElementById('announcementModal').style.display = 'none';
            currentEditIndex = -1;
        }
        
        // ä¿å­˜å…¬å‘Šï¼ˆæ–°å¢æˆ–ç¼–è¾‘ï¼‰
        function saveAnnouncement(event) {
            event.preventDefault();
            
            const title = document.getElementById('announcementTitle').value.trim();
            const content = document.getElementById('announcementContent').value.trim();
            
            // éªŒè¯è¾“å…¥
            if (!title || !content) {
                showSuccessMessage('æ ‡é¢˜å’Œå†…å®¹ä¸èƒ½ä¸ºç©º');
                return;
            }
            
            const newAnnouncement = {
                title: title,
                content: content,
                date: getCurrentDate()
            };
            
            if (currentEditIndex === -1) {
                // æ–°å¢å…¬å‘Š
                newAnnouncement.id = generateUniqueId();
                announcements.push(newAnnouncement);
            } else {
                // ç¼–è¾‘å…¬å‘Š
                // ä¿ç•™åŸæœ‰çš„IDå’Œæ—¥æœŸ
                newAnnouncement.id = announcements[currentEditIndex].id;
                newAnnouncement.date = announcements[currentEditIndex].date;
                announcements[currentEditIndex] = newAnnouncement;
            }
            
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            const saveResult = saveAnnouncementsToStorage();
            if (saveResult) {
                closeAnnouncementModalFunc();
                renderAnnouncements();
                showSuccessMessage(currentEditIndex === -1 ? 'å…¬å‘Šå‘å¸ƒæˆåŠŸï¼' : 'å…¬å‘Šä¿®æ”¹æˆåŠŸï¼');
            } else {
                showSuccessMessage('ä¿å­˜å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
            }
        }
        
        // æ‰“å¼€åˆ é™¤ç¡®è®¤æ¨¡æ€æ¡†
        function confirmDeleteAnnouncement(index) {
            currentDeleteIndex = index;
            const announcement = announcements[index];
            
            document.getElementById('confirmMessage').textContent = `ç¡®å®šè¦åˆ é™¤å…¬å‘Š "${announcement.title}" å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚`;
            document.getElementById('confirmModal').style.display = 'block';
        }
        
        // åˆ é™¤å…¬å‘Š
        function deleteAnnouncement() {
            if (currentDeleteIndex !== -1) {
                const deletedTitle = announcements[currentDeleteIndex].title;
                announcements.splice(currentDeleteIndex, 1);
                
                // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                const saveResult = saveAnnouncementsToStorage();
                if (saveResult) {
                    closeModal('confirmModal');
                    renderAnnouncements();
                    showSuccessMessage(`å…¬å‘Š "${deletedTitle}" åˆ é™¤æˆåŠŸï¼`);
                } else {
                    showSuccessMessage('åˆ é™¤å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
                }
            }
            currentDeleteIndex = -1;
        }
        
        // å…³é—­æ¨¡æ€æ¡†
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        // æ˜¾ç¤ºæˆåŠŸæç¤º
        function showSuccessMessage(message) {
            document.getElementById('successMessage').textContent = message;
            document.getElementById('successModal').style.display = 'block';
        }
        
        // ç”Ÿæˆå”¯ä¸€ID
        function generateUniqueId() {
            return Date.now() + Math.floor(Math.random() * 1000);
        }
        
        // è·å–å½“å‰æ—¥æœŸï¼ˆYYYY-MM-DDæ ¼å¼ï¼‰
        function getCurrentDate() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }
        
        // æ ¼å¼åŒ–æ—¥æœŸæ˜¾ç¤º
        function formatDate(dateString) {
            const date = new Date(dateString);
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}å¹´${month}æœˆ${day}æ—¥`;
        }
        
        // ç®¡ç†å‘˜ç›¸å…³åŠŸèƒ½
        function initAdminAccounts() {
            const accounts = JSON.parse(localStorage.getItem('adminAccounts'));
            if (!accounts) {
                // åˆ›å»ºé»˜è®¤ç®¡ç†å‘˜è´¦å·
                const defaultAccounts = [
                    { username: 'admin', password: 'admin123456', createdAt: new Date().toISOString() }
                ];
                localStorage.setItem('adminAccounts', JSON.stringify(defaultAccounts));
            }
        }
        
        function getAdminAccounts() {
            return JSON.parse(localStorage.getItem('adminAccounts')) || [];
        }
        
        function validateAdminAccount(username, password) {
            const accounts = getAdminAccounts();
            return accounts.find(account => account.username === username && account.password === password);
        }
        
        function generateToken() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            let token = '';
            for (let i = 0; i < 32; i++) {
                token += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return token;
        }
        
        function openAdminLoginModal() {
            document.getElementById('adminLoginModal').style.display = 'block';
            document.getElementById('username').focus();
        }
        
        function closeAdminLoginModal() {
            document.getElementById('adminLoginModal').style.display = 'none';
            document.getElementById('adminLoginForm').reset();
        }
        
        function showLoginMessage(title, message, isSuccess) {
            document.getElementById('loginMessageTitle').textContent = title;
            const messageElement = document.getElementById('loginMessage');
            messageElement.textContent = message;
            messageElement.style.color = isSuccess ? '#10b981' : '#ef4444';
            messageElement.style.textAlign = 'center';
            messageElement.style.fontSize = '1rem';
            messageElement.style.padding = '1rem 0';
            document.getElementById('loginMessageModal').style.display = 'block';
        }
        
        function closeLoginMessageModal() {
            document.getElementById('loginMessageModal').style.display = 'none';
        }
        
        function handleAdminLogin(event) {
            event.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            // éªŒè¯è´¦å·å¯†ç 
            const account = validateAdminAccount(username, password);
            if (account) {
                // ç”Ÿæˆç™»å½•å‡­è¯
                const token = generateToken();
                const expiresAt = new Date(Date.now() + 24 * 60 * 60 * 1000); // 24å°æ—¶è¿‡æœŸ
                
                // å­˜å‚¨ç™»å½•çŠ¶æ€
                localStorage.setItem('adminToken', token);
                localStorage.setItem('adminTokenExpires', expiresAt.toISOString());
                localStorage.setItem('currentAdminUser', JSON.stringify(account));
                
                AuthManager.login(username, password);
                currentAdminUser = account;
                
                toggleAdminFeatures();
                closeAdminLoginModal();
                showLoginMessage('ç™»å½•æˆåŠŸ', `ç®¡ç†å‘˜ ${username} ç™»å½•æˆåŠŸï¼`, true);
                renderAnnouncements();
                
                // è®°å½•ç™»å½•æ—¥å¿—
                logAdminAction('login', `ç®¡ç†å‘˜ ${username} ç™»å½•æˆåŠŸ`);
            } else {
                showLoginMessage('ç™»å½•å¤±è´¥', 'è´¦å·æˆ–å¯†ç é”™è¯¯ï¼', false);
                
                // è®°å½•å¤±è´¥æ—¥å¿—
                logAdminAction('login_failed', `ç®¡ç†å‘˜ç™»å½•å¤±è´¥ï¼Œç”¨æˆ·åï¼š${username}`);
            }
        }
        
        function handleAdminLogout() {
            // è®°å½•é€€å‡ºæ—¥å¿—
            logAdminAction('logout', `ç®¡ç†å‘˜ ${currentAdminUser.username} é€€å‡ºç™»å½•`);
            
            // æ¸…é™¤ç™»å½•çŠ¶æ€
            localStorage.removeItem('adminToken');
            localStorage.removeItem('adminTokenExpires');
            localStorage.removeItem('currentAdminUser');
            AuthManager.logout();
            currentAdminUser = null;
            
            toggleAdminFeatures();
            renderAnnouncements();
            showLoginMessage('é€€å‡ºæˆåŠŸ', 'æ‚¨å·²æˆåŠŸé€€å‡ºç®¡ç†å‘˜ç™»å½•ï¼', true);
        }
        
        function checkLoginStatus() {
            const token = localStorage.getItem('adminToken');
            const expiresAt = localStorage.getItem('adminTokenExpires');
            const userData = localStorage.getItem('currentAdminUser');
            
            if (token && expiresAt && userData) {
                const now = new Date();
                const expiryDate = new Date(expiresAt);
                
                if (now < expiryDate) {
                    // å‡­è¯æœ‰æ•ˆ
                    AuthManager.login(username, password);
                    currentAdminUser = JSON.parse(userData);
                    toggleAdminFeatures();
                    return true;
                } else {
                    // å‡­è¯è¿‡æœŸ
                    handleAdminLogout();
                    return false;
                }
            }
            
            return false;
        }
        
        function toggleAdminFeatures() {
            const adminElements = document.querySelectorAll('.admin-only');
            adminElements.forEach(element => {
                element.style.display = AuthManager.isLoggedIn ? 'inline-block' : 'none';
            });
            
            // åˆ‡æ¢ç™»å½•/é€€å‡ºæŒ‰é’®æ–‡æœ¬
            const loginBtn = document.getElementById('adminLoginBtn');
            loginBtn.textContent = AuthManager.isLoggedIn ? 'é€€å‡ºç™»å½•' : 'ç®¡ç†å‘˜ç™»å½•';
            
            // æ˜¾ç¤º/éšè—è´¦å·ç®¡ç†æŒ‰é’®
            const manageBtn = document.getElementById('adminManageBtn');
            manageBtn.style.display = AuthManager.isLoggedIn ? 'inline-block' : 'none';
        }
        
        function logAdminAction(action, description) {
            // è·å–ç°æœ‰æ—¥å¿—
            const logs = JSON.parse(localStorage.getItem('adminLogs')) || [];
            
            // æ·»åŠ æ–°æ—¥å¿—
            logs.push({
                action,
                description,
                timestamp: new Date().toISOString(),
                user: currentAdminUser ? currentAdminUser.username : 'unknown'
            });
            
            // åªä¿ç•™æœ€è¿‘100æ¡æ—¥å¿—
            if (logs.length > 100) {
                logs.shift();
            }
            
            // ä¿å­˜æ—¥å¿—
            localStorage.setItem('adminLogs', JSON.stringify(logs));
        }
    </script>
</body>
</html>